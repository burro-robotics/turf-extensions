import type {Position} from 'geojson';
import {filterCoordinatesWithMaximumAngularChange} from '../src/coordinates/filter-coordinates-with-maximum-angular-change';

describe('getNewLineSmoothingLine', () => {
  it('should remove adjacent identical points', () => {
    const destinationMap = {
      type: 'FeatureCollection',
      features: [
        {
          type: 'Feature',
          geometry: {
            type: 'LineString',
            coordinates: [
              // these coordinates form a big circle
              [-102.57328836234483, 38.183458461664486],
              [-102.57323156332706, 38.18334553374105],
              [-102.57322036114437, 38.183328712697815],
              [-102.57316690333053, 38.183265683097616],
              [-102.57315927335382, 38.183257688124364],
              [-102.57309746278912, 38.18319991094928],
              [-102.573091766409, 38.18319497032935],
              [-102.57302327364066, 38.18313981935048],
              [-102.5730023635642, 38.18312653670363],
              [-102.5729121536374, 38.18308189065069],
              [-102.57290315783406, 38.18307787305145],
              [-102.57281795958549, 38.18304373193557],
              [-102.57279742646148, 38.18303738110895],
              [-102.57270387546926, 38.18301637118536],
              [-102.57268227071098, 38.18301324326253],
              [-102.57258537862455, 38.18300667766048],
              [-102.57256630565034, 38.18300663950261],
              [-102.57250449518152, 38.18301057886394],
              [-102.57250021645142, 38.18301091528539],
              [-102.57243005321556, 38.18301748088713],
              [-102.5724211400891, 38.18301859673914],
              [-102.57232925965695, 38.183033041061144],
              [-102.57230153678728, 38.183040398616356],
              [-102.5722330440798, 38.183066661015296],
              [-102.5722221889367, 38.18307141330914],
              [-102.57214534344341, 38.18310949377331],
              [-102.57214089496304, 38.183111813935696],
              [-102.57206906112448, 38.183151207499584],
              [-102.57205362403249, 38.18316137166205],
              [-102.57200183681965, 38.18320207832807],
              [-102.57199627838567, 38.18320677067357],
              [-102.57195284393745, 38.18324616420219],
              [-102.57193850746499, 38.183262514222406],
              [-102.5718900612928, 38.18333342253619],
              [-102.5718823168329, 38.18334753279894],
              [-102.57185224674443, 38.18341844105742],
              [-102.57184712955392, 38.183436571698756],
              [-102.57183710611727, 38.18350485367722],
              [-102.57183638442113, 38.183513021429306],
              [-102.57183471377931, 38.18356817221753],
              [-102.57183503623875, 38.18357739072333],
              [-102.5718400478269, 38.18362728902588],
              [-102.5718417963478, 38.183637376441915],
              [-102.57185349016446, 38.18368464849301],
              [-102.57185439712782, 38.183687977296664],
              [-102.5718727731464, 38.183749693542275],
              [-102.5718802112242, 38.18376674604176],
              [-102.5719370099934, 38.183863916217575],
              [-102.5719501754829, 38.18388108703574],
              [-102.57198859823353, 38.18392048032263],
              [-102.57199600737444, 38.18392733706578],
              [-102.57204779458147, 38.183970669660816],
              [-102.57205302216974, 38.1839747701657],
              [-102.57210480938842, 38.18401285030586],
              [-102.57210511894884, 38.184013077089105],
              [-102.57215189450176, 38.184047217887574],
              [-102.57217393381028, 38.18405982184521],
              [-102.572230732731, 38.18408477088448],
              [-102.57223769070843, 38.18408758619886],
              [-102.57229783074968, 38.184109909017074],
              [-102.57231325218123, 38.18411459472357],
              [-102.57237339223474, 38.18412903889734],
              [-102.57237971490332, 38.18413040304074],
              [-102.57244820774599, 38.18414353410555],
              [-102.57245867215825, 38.184145138374916],
              [-102.57251547110472, 38.184151703906586],
              [-102.57253211748146, 38.18415266085839],
              [-102.57258724587288, 38.18415266085839],
              [-102.57261325626253, 38.18415030607893],
              [-102.5726890520708, 38.1841363976327],
              [-102.5727083283446, 38.184131407592865],
              [-102.57280292934564, 38.184099357308035],
              [-102.57280880957984, 38.18409720780465],
              [-102.57286894961877, 38.184073571875736],
              [-102.5728720256876, 38.184072316802684],
              [-102.57293717739275, 38.184044741543055],
              [-102.57294179914042, 38.18404267510059],
              [-102.57301697417775, 38.18400722118103],
              [-102.57303644488137, 38.18399565191312],
              [-102.57309157321059, 38.1839549455462],
              [-102.57309604236183, 38.183951458674194],
              [-102.5731645351214, 38.183894994969044],
              [-102.5731783883502, 38.183881053438725],
              [-102.57321012886867, 38.18384166013765],
              [-102.57321620434284, 38.18383312607538],
              [-102.57325796815242, 38.18376615742254],
              [-102.5732644392133, 38.18375339768919],
              [-102.57328949745686, 38.18369036832366],
              [-102.57329204476171, 38.18368282594708],
              [-102.57330707968036, 38.1836289883264],
              [-102.5733097027963, 38.18361201143924],
              [-102.57331137327122, 38.183560800019],
              [-102.5733096698853, 38.18354286595327],
              [-102.57329463478767, 38.1834758971351],
              [-102.57328836234483, 38.183458461664486],
            ],
          },
          properties: {
            direction: 'two_way',
            speed_limit: 0,
          },
          id: 'ec260802-bf85-4697-9161-44ca24eff4af',
        },
        {
          id: '28937',
          type: 'Feature',
          properties: {
            direction: 'two_way',
            speed_limit: 0,
          },
          geometry: {
            coordinates: [
              // form a very tight triangle
              [-102.5726348313252, 38.18357902323525],
              [-102.57261666744479, 38.183646369568805],
              [-102.57259884627912, 38.18357888854252],
            ],
            type: 'LineString',
          },
        },
      ],
      id: '6228b99c-7382-410c-90f6-a986dc5a946b',
      properties: {
        folders: [],
        name: 'test',
      },
    };

    const maximumAngle = 15;

    const circle = filterCoordinatesWithMaximumAngularChange({
      coordinates: destinationMap.features![0].geometry
        .coordinates as Position[],
      maximumAngle,
    });

    expect(circle.length).toBe(0);

    const tightAngle = filterCoordinatesWithMaximumAngularChange({
      coordinates: destinationMap.features![1].geometry
        .coordinates as Position[],
      maximumAngle,
    });

    expect(tightAngle).toEqual([[-102.57261666744479, 38.183646369568805]]);
  });
});
